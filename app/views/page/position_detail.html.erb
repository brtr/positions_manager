<div class="m-3 row">
  <div class="col-10 mx-auto">
    <div class="mb-3 mt-3 col-10">
      <%= form_tag position_detail_path, id: "search_targets", method: "GET" do %>
        <h5>切换币种(请输入全称,比如BTCUSDT)</h5>
        <div class="input-group mb-3">
          <%= text_field_tag :origin_symbol, @symbol, class: "form-control" %>
          <span class='ms-3'></span>
          <%= select_tag(:source, options_for_select(['binance', 'okx'], @source),{ prompt: '请选择来源...', class: 'select2-dropdown form-control'}) %>
          <span class='ms-3'></span>
          <%= select_tag(:trade_type, options_for_select([['做空', 'buy'], ['做多', 'sell']], @trade_type),{ prompt: '请选择交易类别...', class: 'select2-dropdown form-control'}) %>
          <span class='ms-3'></span>
          <button type="submit" class="btn btn-primary">确定</button>
        </div>
      <% end %>
    </div>
    <h3><%= "#{@symbol}历史投入" %></h3>
    <% if @data.any? %>
      <div class="mt-3">
        <table class="table">
          <thead>
            <tr class="table-container-tr">
              <th>时间</th>
              <th>类别</th>
              <th>平均成本价</th>
              <th>最新价格</th>
              <th>新增数量</th>
              <th>新增金额</th>
              <th>
                新增收益
                <span class="question-mark" data-bs-toggle="tooltip" title='<%= t("views.contract_trading.revenue") %>'>?</span>
              </th>
              <th>新增收益占新增金额的占比</th>
              <th>新增金额占当前该币种总仓位的占比</th>
              <th>来源</th>
            </tr>
          </thead>
          <tbody>
            <% @data.each do |d| %>
              <tr>
                <td><%= d.event_date.to_s %></td>
                <td class="<%= trade_type_style(d.trade_type) %>"><%= I18n.t("views.contract_trading.#{d.trade_type}") %></td>
                <td><%= d.price.round(3) %></td>
                <td><%= d.current_price.round(3) %></td>
                <td class="<%= d.qty.to_f > 0 ? 'pos-num' : 'neg-num' %>"><%= d.qty %></td>
                <td class="<%= d.amount.to_f > 0 ? 'pos-num' : 'neg-num' %>"><%= d.amount.round(3) %></td>
                <td class="<%= d.revenue.to_f > 0 ? 'pos-num' : 'neg-num' %>"><%= d.revenue.round(3) %></td>
                <td><%= "#{d.roi}%" %></td>
                <td><%= "#{d.amount_ratio}" %></td>
                <td><%= d.source %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
        <div class="p-4">
          <%= paginate @data %>
        </div>
      </div>
    </div>
    <div class="col-10 mx-auto">
      <h3>
        <%= "#{@symbol}委托单" %>
      </h3>
      <div class="mt-3">
        <table class="table">
          <thead>
            <tr class="table-container-tr">
              <th>类别</th>
              <th>委托价</th>
              <th>委托数量</th>
              <th>订单类型</th>
            </tr>
          </thead>
          <tbody>
            <% if @open_orders %>
              <% @open_orders.first(20).each do |d| %>
                <tr>
                  <td class="<%= trade_type_style(d['side'].downcase) %>"><%= I18n.t("views.trading.#{d['side'].downcase}") %></td>
                  <td><%= d['price'].to_f.round(3) %></td>
                  <td><%= d['origQty'] %></td>
                  <td><%= d['origType'] %></td>
                </tr>
              <% end %>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
    <div class="p-4"></div>
    <div class="col-10 chart mx-auto">
      <h3>
        <%= "#{@symbol}币价折线图" %>
      </h3>
      <div>
        <%= render partial: "position_detail_chart" %>
      </div>
    </div>
  <% else %>
    <h3 class="mt-5">暂无相关数据</h3>
  <% end %>
</div>